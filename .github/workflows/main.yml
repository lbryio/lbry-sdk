name: ci
#on: [push, pull_request]
on: push
jobs:

#  lint:
#    name: "pylint & mypy"
#    runs-on: ubuntu-16.04
#    steps:
#      - uses: actions/checkout@v1
#      - uses: actions/setup-python@v1
#        with:
#          python-version: '3.7'
#      - run: make install tools
#      - run: make lint
#
#  tests-unit:
#    needs: lint
#    name: "tests / unit"
#    runs-on: ubuntu-16.04
#    steps:
#      - uses: actions/checkout@v1
#      - uses: actions/setup-python@v1
#        with:
#          python-version: '3.7'
#      - run: make install tools
#      - working-directory: lbry
#        env:
#          HOME: /tmp
#        run: coverage run -p --source=lbry -m unittest discover -vv tests.unit
#
#  tests-integration:
#    needs: lint
#    name: "tests / integration"
#    runs-on: ubuntu-16.04
#    steps:
#      - uses: actions/checkout@v1
#      - uses: actions/setup-python@v1
#        with:
#          python-version: '3.7'
#      - run: pip install coverage tox-travis
#      - working-directory: lbry
#        run: tox
#
  linux-build:
    #needs: ["tests-unit", "tests-integration"]
    name: "build / linux"
    runs-on: ubuntu-16.04
    steps:
      - uses: actions/checkout@v1
      - uses: actions/setup-python@v1
        with:
          python-version: '3.7'
      - name: Install
        run: |
          pip install pyinstaller awscli
          #python docker/set_build.py
          pip install -e torba/.
          pip install -e lbry/.
      - name: Build
        run: |
          pyinstaller -F -n lbrynet lbry/lbry/extras/cli.py
          chmod +x dist/lbrynet
          zip --junk-paths lbrynet-linux.zip dist/lbrynet
          shasum -a 256 -b lbrynet-linux.zip
      - run: dist/lbrynet --version
      - name: setup aws
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1
      - name: upload to aws
        run: aws s3 cp lbrynet-linux.zip s3://build.lbry.io/daemon/build-github-actions-1/lbrynet-linux.zip

#  mac-build:
#    needs: ["tests-unit", "tests-integration"]
#    name: "build / mac"
#    runs-on: macos-latest
#    steps:
#      - uses: actions/checkout@v1
#      - uses: actions/setup-python@v1
#        with:
#          python-version: '3.7'
#      - name: Install
#        run: |
#          pip install pyinstaller awscli
#          #python docker/set_build.py
#          pip install -e torba/.
#          pip install -e lbry/.
#      - name: Build
#        run: |
#          pyinstaller -F -n lbrynet lbry/lbry/extras/cli.py
#          chmod +x dist/lbrynet
#          zip --junk-paths lbrynet-mac.zip dist/lbrynet
#          shasum -a 256 -b lbrynet-mac.zip
#      - run: dist/lbrynet --version

#  windows-build:
#    needs: ["tests-unit", "tests-integration"]
#    name: "build / windows"
#    runs-on: windows-latest
#    steps:
#      - uses: actions/checkout@v1
#      - uses: actions/setup-python@v1
#        with:
#          python-version: '3.7'
#      - name: Install
#        run: |
#          pip install pyinstaller awscli
#          #python docker/set_build.py
#          pip install pywin32
#          pip install -e torba/.
#          pip install -e lbry/.
#      - name: Build
#        run: |
#          pyinstaller --additional-hooks-dir=lbry/scripts/. --icon=lbry/icons/lbry256.ico -F -n lbrynet lbry/lbry/extras/cli.py
#          cd dist
#          7z a -tzip lbrynet-windows.zip lbrynet.exe
#          sha256sum -b lbrynet-windows.zip
#      - run: ./dist/lbrynet.exe --version
